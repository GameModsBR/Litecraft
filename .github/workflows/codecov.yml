name: Codecov

on: [push,pull_request]

jobs:
  codecov:

    runs-on: ubuntu-latest
    
    if: github.event_name == 'push' || github.event.pull_request.head.repo.full_name != github.repository

    steps:
    - uses: actions/checkout@v2
    - name: Set up JDK 14
      uses: actions/setup-java@v1
      with:
        java-version: 14
    - name: Grant execute permission for gradlew
      run: chmod +x gradlew
    - name: Build and generate coverage report
      run: ./gradlew codeCoverageReport
    - name: ls 1
      run: ls build/
    - name: ls 2
      run: ls build/reports/
    - name: ls 3
      run: ls build/reports/jacoco
    - name: cat
      run: cat build/reports/jacoco/codeCoverageReport.xml
    - uses: codecov/codecov-action@v1
      with:
        #token: ${{ secrets.CODECOV_TOKEN }} # not required for public repos
        file: build/reports/jacoco/codeCoverageReport.xml
        flags: unittests # optional
        #name: codecov-umbrella # optional
        fail_ci_if_error: true # optional (default = false)
